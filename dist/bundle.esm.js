function _classCallCheck(r,t){if(!(r instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(r,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function _createClass(r,t,e){return t&&_defineProperties(r.prototype,t),e&&_defineProperties(r,e),r}function _toConsumableArray(r){return _arrayWithoutHoles(r)||_iterableToArray(r)||_nonIterableSpread()}function _arrayWithoutHoles(r){if(Array.isArray(r)){for(var t=0,e=new Array(r.length);t<r.length;t++)e[t]=r[t];return e}}function _iterableToArray(r){if(Symbol.iterator in Object(r)||"[object Arguments]"===Object.prototype.toString.call(r))return Array.from(r)}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}var Validator=function(){function r(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{first:!0,concurrent:!1};_classCallCheck(this,r),this.transformToPromise=function(r,t,n){for(var a=arguments.length,i=new Array(a>3?a-3:0),o=3;o<a;o++)i[o-3]=arguments[o];if("function"!=typeof r.validator)throw"invalid validator";var l=r.validator.apply(r,[t].concat(i));l&&l.then&&l.catch||(l=l?Promise.resolve(l):Promise.reject(l));var s={errors:n,target:t};return l.then(function(r){return Object.assign(s,{promiseValue:r})},function(a){return s.errors=e.messageHandler.apply(e,[n,r.message,t,a].concat(i)),Promise.reject(Object.assign(s,{promiseValue:a}))})},this.lastValidator={},this.schema=t,this.options=n}return _createClass(r,[{key:"validate",value:function(r,t){for(var e=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length,i=new Array(a>3?a-3:0),o=3;o<a;o++)i[o-3]=arguments[o];var l=[];return!t||t.length<1?Promise.resolve({value:r}):(Array.isArray(t)||(t=[t]),n.concurrent?Promise.all(t.map(function(t){return e.transformToPromise.apply(e,[t,r,l].concat(i)).then(function(r){return r},n.first?function(r){return r}:null)})):t.reduce(function(t,a){return t.then(function(){return e.transformToPromise.apply(e,[a,r,l].concat(i))},n.first?null:function(){return e.transformToPromise.apply(e,[a,r,l].concat(i))})},Promise.resolve()))}},{key:"validateItem",value:function(r,t,e){var n=this,a=this.schema[t],i=r[t];if(a&&a.rules&&(a=a.rules),a&&a.withFields){var o=Array.isArray(a.withFields)?a.withFields:[a.withFields];i=[t].concat(_toConsumableArray(o)).map(function(t){return r[t]})}for(var l=arguments.length,s=new Array(l>3?l-3:0),c=3;c<l;c++)s[c-3]=arguments[c];var u=this.validate.apply(this,[i,a,this.options].concat(s));return this.lastValidator[t]=u,u.then(function(r){return e&&n.lastValidator[t]===u&&(n.lastValidator[t]=null,e(null,r.target)),r},function(r){return e&&n.lastValidator[t]===u&&(n.lastValidator[t]=null,e(r.errors,r.target)),r})}},{key:"validateAll",value:function(r,t){var e=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=!1,i={},o=[];return(n.specificField||Object.keys(this.schema)).forEach(function(t){o.push(e.validateItem(r,t,function(r){i[t]=r,n.fieldCallback&&n.fieldCallback(t,r)}))}),Promise.all(o.map(function(r){return r.catch(function(r){return a=!0,r})})).then(function(){return t(i,!a),a?null:i})}},{key:"messageHandler",value:function(r,t,e,n){if("function"==typeof t){for(var a=arguments.length,i=new Array(a>4?a-4:0),o=4;o<a;o++)i[o-4]=arguments[o];r.push("".concat(t.apply(void 0,[e,n].concat(i))||"Error!").trim())}else r.push("".concat(null!=t?t:"Error!").trim());return r}},{key:"cancelItem",value:function(r){this.lastValidator[r]=null}},{key:"cancelAll",value:function(){this.lastValidator={}}},{key:"setSchema",value:function(r){this.schema=r}},{key:"setOptions",value:function(r){this.options=r}}]),r}();export default Validator;
//# sourceMappingURL=bundle.esm.js.map
