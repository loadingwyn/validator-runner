!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.validator=t()}(this,function(){"use strict";function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}return function(){function r(e){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.transformToPromise=function(e,r,i,o){var a=r.validator.apply(r,t(i)),u=!0;a&&a.then&&a.catch||(u=!1,a=a?Promise.resolve(a):Promise.reject(a));var c={errors:o,fieldName:e,target:i,isAsync:u};return a.then(function(e){return Object.assign(c,{promiseValue:e})},function(e){return c.errors=n.messageHandler(o,r.message,i,e),Promise.reject(Object.assign(c,{promiseValue:e}))})},this.lastValidator={},this.descriptor=e}var n,i,o;return n=r,(i=[{key:"validateItem",value:function(e,r,n){var i,o=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{first:!0,cover:!0,concurrent:!1},u=arguments.length>4?arguments[4]:void 0,c=[],l=u||this.descriptor[r];if(l&&!(l.length<1))return Array.isArray(l)||(l=[l]),i=a.concurrent?Promise.all(l.map(function(n){var i=[r].concat(t(n.join||[])).map(function(t){return e[t]});return o.transformToPromise(r,n,i,c).then(function(e){return e},a.first?null:function(e){return e})})):l.reduce(function(n,i){var u=[r].concat(t(i.join||[])).map(function(t){return e[t]});return n.then(function(){return o.transformToPromise(r,i,u,c)},a.first?null:function(){return o.transformToPromise(r,i,u,c)})},Promise.resolve()),this.lastValidator[r]=i,i.then(function(e){return(!a.cover||o.lastValidator[r]===i)&&n&&n(c,e),e},function(e){return(!a.cover||o.lastValidator[r]===i)&&n&&n(c,e),Promise.reject(e)});n(c,{})}},{key:"validate",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=!1,o={},a=[];return(n.specificField||Object.keys(this.descriptor)).forEach(function(t){a.push(r.validateItem(e,t,function(e){o[t]=e,n.fieldCallback&&n.fieldCallback(t,e)},n))}),Promise.all(a.map(function(e){return e.catch(function(e){return i=!0,e})})).then(function(){return t(o,!i),i?Promise.reject(o):o})}},{key:"messageHandler",value:function(e,r,n,i){return"function"==typeof r?e.push("".concat(r.apply(void 0,t(n).concat([i]))||"Error!").trim()):e.push("".concat(r||"Error!").trim()),e}},{key:"cancelItem",value:function(e){this.lastValidator[e]=null}},{key:"cancelAll",value:function(){this.lastValidator={}}},{key:"addRule",value:function(e){this.ruleSet=Object.assign(this.ruleSet,e)}},{key:"updateRuleSet",value:function(e){this.ruleSet=e}},{key:"deleteRule",value:function(e){delete this.ruleSet[e]}}])&&e(n.prototype,i),o&&e(n,o),r}()});
