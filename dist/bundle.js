!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.validator=t()}(this,function(){"use strict";function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}return function(){function r(e){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.transformToPromise=function(e,r,i,a){var o=r.validator.apply(r,t(i)),u=!0;o&&o.then&&o.catch||(u=!1,o=o?Promise.resolve(o):Promise.reject(o));var l={errors:a,fieldName:e,target:i,isAsync:u};return o.then(function(e){return Object.assign(l,{promiseValue:e})},function(e){return l.errors=n.messageHandler(a,r.message,i,e),Promise.reject(Object.assign(l,{promiseValue:e}))})},this.lastValidator={},this.descriptor=e}var n,i,a;return n=r,(i=[{key:"validateItem",value:function(e,r,n){var i,a=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{traversal:!1,retention:!1,concurrent:!1},u=arguments.length>4?arguments[4]:void 0,l=[],c=u||this.descriptor[r];if(c&&!(c.length<1))return Array.isArray(c)||(c=[c]),i=o.concurrent?Promise.all(c.map(function(n){var i=[r].concat(t(n.join||[])).map(function(t){return e[t]});return a.transformToPromise(r,n,i,l).then(function(e){return e},o.traversal?function(e){return e}:null)})):c.reduce(function(n,i){var u=[r].concat(t(i.join||[])).map(function(t){return e[t]});return n.then(function(){return a.transformToPromise(r,i,u,l)},o.traversal?function(){return a.transformToPromise(r,i,u,l)}:null)},Promise.resolve()),this.lastValidator[r]=i,i.then(function(e){return(o.retention||a.lastValidator[r]===i)&&n&&n(l,e),e},function(e){return(o.retention||a.lastValidator[r]===i)&&n&&n(l,e),Promise.reject(e)});n(l,{})}},{key:"validate",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=!1,a={},o=[];return(n.specificField||Object.keys(this.descriptor)).forEach(function(t){o.push(r.validateItem(e,t,function(e){a[t]=e,n.fieldCallback&&n.fieldCallback(t,e)},n))}),Promise.all(o.map(function(e){return e.catch(function(e){return i=!0,e})})).then(function(){return t(a,!i),i?Promise.reject(a):a})}},{key:"messageHandler",value:function(e,r,n,i){return"function"==typeof r?e.push("".concat(r.apply(void 0,t(n).concat([i]))||"Error!").trim()):e.push("".concat(r||"Error!").trim()),e}},{key:"cancelItem",value:function(e){this.lastValidator[e]=null}},{key:"cancelAll",value:function(){this.lastValidator={}}},{key:"addRule",value:function(e){this.ruleSet=Object.assign(this.ruleSet,e)}},{key:"updateRuleSet",value:function(e){this.ruleSet=e}},{key:"deleteRule",value:function(e){delete this.ruleSet[e]}}])&&e(n.prototype,i),a&&e(n,a),r}()});
